**Настройка PostgreSQL**  
  
*Настройки взятых с сайта https://www.pgconfig.org/ для следующих параметров сервера:*  
  
> GNU/Linux Based
> Architecture
> 64 Bits (x86-64)
> Storage type
> SSD Storage
> Number of CPUs 8
> Total Memory (GB) 128
> Max connections 200
> Database
> Application profile - DataWare house and BI Applications
> PostgreSQL Version - 16
  
*Формируем команды для измененния настроек:*  
> ALTER SYSTEM SET shared_buffers = '4GB'; \# С большим значением сервер не запускается
> ALTER SYSTEM SET effective_cache_size = '96GB';
> ALTER SYSTEM SET work_mem = '328MB';
> ALTER SYSTEM SET maintenance_work_mem = '6GB';
> ALTER SYSTEM SET min_wal_size = '2GB';
> ALTER SYSTEM SET max_wal_size = '3GB';
> ALTER SYSTEM SET checkpoint_completion_target = 0.9;
> ALTER SYSTEM SET wal_buffers = -1;
> ALTER SYSTEM SET listen_addresses = '*';
> ALTER SYSTEM SET max_connections = 200;
> ALTER SYSTEM SET random_page_cost = 1.1;
> ALTER SYSTEM SET effective_io_concurrency = 200;
> ALTER SYSTEM SET max_worker_processes = 8;
> ALTER SYSTEM SET max_parallel_workers_per_gather = 2;
> ALTER SYSTEM SET max_parallel_workers = 2;
> ALTER SYSTEM SET logging_collector = on;
> ALTER SYSTEM SET log_checkpoints = on;
> ALTER SYSTEM SET log_connections = on;
> ALTER SYSTEM SET log_disconnections = on;
> ALTER SYSTEM SET log_lock_waits = on;
> ALTER SYSTEM SET log_temp_files = 0;
> ALTER SYSTEM SET lc_messages = 'C';
> ALTER SYSTEM SET log_min_duration_statement = '10s';
> ALTER SYSTEM SET log_autovacuum_min_duration = 0;
> ALTER SYSTEM SET log_destination = 'csvlog';
> \q
> *Сохнаняем их в сценарий set_conf.sql*  
  
*Применяем сценарий, перезапускаем сервер для применения и проверяем что сервер запущен*  
> $ psql < set_conf.sql
> Много ALTER SYSTEM
> \# systemctl restart postgresql-16.service
> \# systemctl status postgresql-16.service 
> ● postgresql-16.service - PostgreSQL 16 database server
>      Loaded: loaded (/usr/lib/systemd/system/postgresql-16.service; disabled; preset: disable>
>      Active: active (running)
  
*Проверяем что параметры применились*  
> $ cat $PGDATA/postgresql.auto.conf
> \# Do not edit this file manually!
> \# It will be overwritten by the ALTER SYSTEM command.
> shared_buffers = '4GB'
> effective_cache_size = '96GB'
> work_mem = '328MB'
> maintenance_work_mem = '6GB'
> min_wal_size = '2GB'
> max_wal_size = '3GB'
> checkpoint_completion_target = '0.9'
> wal_buffers = '-1'
> listen_addresses = '*'
> max_connections = '200'
> random_page_cost = '1.1'
> effective_io_concurrency = '200'
> max_worker_processes = '8'
> max_parallel_workers_per_gather = '2'
> max_parallel_workers = '2'
> logging_collector = 'on'
> log_checkpoints = 'on'
> log_connections = 'on'
> log_disconnections = 'on'
> log_lock_waits = 'on'
> log_temp_files = '0'
> lc_messages = 'C'
> log_min_duration_statement = '10s'
> log_autovacuum_min_duration = '0'
> log_destination = 'csvlog'
  
*Инициализация*  
> $ /usr/pgsql-16/bin/pgbench -i postgres
> dropping old tables...
> NOTICE:  table "pgbench_accounts" does not exist, skipping
> NOTICE:  table "pgbench_branches" does not exist, skipping
> NOTICE:  table "pgbench_history" does not exist, skipping
> NOTICE:  table "pgbench_tellers" does not exist, skipping
> creating tables...
> generating data (client-side)...
> 100000 of 100000 tuples (100%) done (elapsed 0.11 s, remaining 0.00 s)
> vacuuming...
> creating primary keys...
> done in 0.60 s (drop tables 0.01 s, create tables 0.06 s, client-side generate 0.31 s, vacuum 0.11 s, primary keys 0.13 s).
  
*Запуск тестирования*  
> $ /usr/pgsql-16/bin/pgbench -d postgres -c 90 -j 6 -P 10 -T 30
*Результаты с настройками:*  
> transaction type: <builtin: TPC-B (sort of)>
> scaling factor: 1
> query mode: simple
> number of clients: 90
> number of threads: 6
> maximum number of tries: 1
> duration: 30 s
> number of transactions actually processed: 7546
> number of failed transactions: 0 (0.000%)
> latency average = 353.001 ms
> latency stddev = 484.314 ms
> initial connection time = 565.788 ms
> tps = 253.082587 (without initial connection time)
  
*Отменяем настройки*  
> $ psql -c "ALTER SYSTEM RESET ALL;"
> ALTER SYSTEM
  
*Проверяем что параметры применились*  
> $ cat $PGDATA/postgresql.auto.conf
> \# Do not edit this file manually!
> \# It will be overwritten by the ALTER SYSTEM command.
  
*Запуск тестирования*  
> $ /usr/pgsql-16/bin/pgbench -d postgres -c 90 -j 6 -P 10 -T 30
*Результаты без настроек:*  
> transaction type: <builtin: TPC-B (sort of)>
> scaling factor: 1
> query mode: simple
> number of clients: 90
> number of threads: 6
> maximum number of tries: 1
> duration: 30 s
> number of transactions actually processed: 7570
> number of failed transactions: 0 (0.000%)
> latency average = 355.745 ms
> latency stddev = 453.624 ms
> initial connection time = 270.884 ms
> tps = 251.193551 (without initial connection time)
  
*Вывод:*  
*Научились изменять настройки Postgres*  
*Не на много, но количество транзакций в секунду изменилось.*  
